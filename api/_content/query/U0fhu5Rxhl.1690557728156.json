{"_path":"/usage/services/serversupabaseclient","_dir":"services","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"serverSupabaseClient","description":"Make requests to the Supabase API on server side with the serverSupabaseClient service","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"serversupabaseclient"},"children":[{"type":"text","value":"serverSupabaseClient"}]},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section assumes you're familiar with "},{"type":"element","tag":"a","props":{"href":"https://v3.nuxtjs.org/guide/concepts/server-engine","rel":["nofollow"]},"children":[{"type":"text","value":"Nitro"}]},{"type":"text","value":", the server engine powered by Nuxt."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This function is working similary as the "},{"type":"element","tag":"a","props":{"href":"/usage/composables/usesupabaseclient"},"children":[{"type":"text","value":"useSupabaseClient"}]},{"type":"text","value":" composable but is designed to be used in "},{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/guide/directory-structure/server#server-routes","rel":["nofollow"]},"children":[{"type":"text","value":"server routes"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Define your server route and just import the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"serverSupabaseClient"}]},{"type":"text","value":" from "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"#supabase/server"}]},{"type":"text","value":"."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"import { serverSupabaseClient } from '#supabase/server'\n\nexport default eventHandler(async (event) => {\n  const client = serverSupabaseClient(event)\n\n  const { data } = await client.from('libraries').select()\n\n  return { libraries: data }\n})\n","filename":"server/api/libraries.ts","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" { serverSupabaseClient } "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'#supabase/server'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"eventHandler"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"event"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"client"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"serverSupabaseClient"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"(event)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" client."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'libraries'"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":")."}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" { libraries: data }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then call your API route from any vue file:"}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"const fetchLibrary = async () => {\n  const { libraries } = await $fetch('/api/libraries')\n}\n","filename":"pages/index.vue","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"fetchLibrary"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" () "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"libraries"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" } "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"$fetch"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'/api/libraries'"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Be careful, if you want to call this route on SSR, please read this "},{"type":"element","tag":"a","props":{"href":"https://nuxt.com/docs/getting-started/data-fetching#isomorphic-fetch-and-fetch","rel":["nofollow"]},"children":[{"type":"text","value":"section"}]},{"type":"text","value":", you must send your browser cookies including your supabase token."}]},{"type":"element","tag":"code","props":{"className":["language-ts"],"code":"const { data: { libraries }} = await useFetch('/api/libraries', {\n  headers: useRequestHeaders(['cookie'])\n})\n","filename":"pages/index.vue","language":"ts","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"class":"ct-684589"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":": { "}]},{"type":"element","tag":"span","props":{"class":"ct-484930"},"children":[{"type":"text","value":"libraries"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" }} "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-135336"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"useFetch"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'/api/libraries'"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":", {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"  headers: "}]},{"type":"element","tag":"span","props":{"class":"ct-970614"},"children":[{"type":"text","value":"useRequestHeaders"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-497092"},"children":[{"type":"text","value":"'cookie'"}]},{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-948368"},"children":[{"type":"text","value":"})"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".dark .ct-135336{color:#F97583;}\n.ct-135336{color:#D73A49;}\n.dark .ct-948368{color:#E1E4E8;}\n.ct-948368{color:#24292E;}\n.dark .ct-497092{color:#9ECBFF;}\n.ct-497092{color:#032F62;}\n.dark .ct-970614{color:#B392F0;}\n.ct-970614{color:#6F42C1;}\n.dark .ct-684589{color:#FFAB70;}\n.ct-684589{color:#E36209;}\n.dark .ct-484930{color:#79B8FF;}\n.ct-484930{color:#005CC5;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:3.usage:services:1.serverSupabaseClient.md","_source":"content","_file":"3.usage/services/1.serverSupabaseClient.md","_extension":"md"}